plugins {
  id 'com.github.johnrengelman.shadow' version '8.1.1'
}

configurations {
  // Create a resolvable configuration that extends compileOnly
  compileOnlyResolved {
    canBeResolved = true
    canBeConsumed = false
    extendsFrom configurations.compileOnly
  }
}

dependencies {
  compileOnly 'io.trino:trino-parser:355'
  implementation project(':shading:guava-shaded')
}

tasks.named('shadowJar').configure {
  // Use the resolvable configuration instead of compileOnly
  configurations = [
    project.configurations.compileOnlyResolved
  ]
  archiveClassifier.set(null)
  relocate('io.trino', 'coral.shading.io.trino')
}

tasks.named('jar').configure {
  enabled = false
}

tasks.named('assemble').configure {
  dependsOn tasks.named('shadowJar')
}
